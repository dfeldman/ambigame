<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ambigame</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }
        .tiles {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 90%; /* Adjust this value as needed */
    margin-bottom: 20px;
    margin-top: 20px;
        }
        button {
            font-size: 24px;
            font-weight: bold;
            margin: 5px;
            padding: 10px;
            border: 1px solid black;
            cursor: pointer;
	    button: #eeeeee;
        }
        .form-field {
            margin: 10px;
            font-size: 48px;
            text-align: center;
        }
        .validation-message {
            font-size: 32px;
            margin-left: 10px;
        }
        #winMessage {
            font-size: 32px;
            color: green;
            display: none;
        }
	h1 {font-size: 32px; color: black;}
	.instructions { font-size: 16pt; color:black; background: #eeeeee; border: 1px solid black; max-width:60%; padding: 20px;}
    </style>
</head>
<body>
    <h1>Ambigame</h1>
    <div class="instructions"> This is a prototype of a game. The idea is that you'll have 3D <a href="https://en.wikipedia.org/wiki/Ambigram">Ambigram</a> letters, 
	    somewhat like <a href="https://www.thingiverse.com/thing:4826437">this</a>. You'll have to arrange these ambigram letters to make two words at the same time. The purpose of this prototype is to try out the game. Try to make two words at the same time, using tiles that have two letters!</div>
    <div class="tiles" id="tiles"></div>
    <div>
        <input type="text" id="topWord" class="form-field" readonly>
        <span id="topValidation" class="validation-message"></span>
    </div>
    <div>
        <input type="text" id="bottomWord" class="form-field" readonly>
        <span id="bottomValidation" class="validation-message"></span>
    </div>
    <span id="winMessage">YOU WIN!</span>
    <button onclick="backspace()">Backspace</button>
    <button onclick="clearWords()">Clear</button>
    <button onclick="restartGame()">Restart</button>

    <script src="words.js"></script> <!-- Load the word set -->
    <script src="frequencies.js"></script> <!-- Load the frequency distribution -->
    <script>
        const tilesContainer = document.getElementById("tiles");
        const topWordField = document.getElementById("topWord");
        const bottomWordField = document.getElementById("bottomWord");
        const topValidation = document.getElementById("topValidation");
        const bottomValidation = document.getElementById("bottomValidation");
        const winMessage = document.getElementById("winMessage");

        const usedTilesStack = []; // Stack to keep track of used tiles


        function selectRandomTile(frequencies) {
            const totalFrequency = Object.values(frequencies).reduce((acc, freq) => acc + freq, 0);
            let random = Math.random() * totalFrequency;
            for (const [tile, freq] of Object.entries(frequencies)) {
                random -= freq;
                if (random <= 0) {
                    return tile;
                }
            }
        }

        function createTile(tile) {
            const button = document.createElement("button");
            button.innerHTML = `${tile[0].toUpperCase()}<br>${tile[2].toUpperCase()}`;
            button.addEventListener("click", () => {
                topWordField.value += tile[0].toUpperCase();
                bottomWordField.value += tile[2].toUpperCase();
		button.disabled = true;
		usedTilesStack.push(button);
                checkWords(); // Automatically check words after each tile is added
            });
            tilesContainer.appendChild(button);
        }

        function createTiles() {
            tilesContainer.innerHTML = ''; // Clear existing tiles
            for (let i = 0; i < 20; i++) { // Create 10 tiles based on frequency
                const tile = selectRandomTile(frequencies);
                createTile(tile);
            }
        }

        function clearWords() {
            topWordField.value = '';
            bottomWordField.value = '';
            topValidation.textContent = '';
            bottomValidation.textContent = '';
            winMessage.style.display = 'none';
        while (usedTilesStack.length > 0) {
            const button = usedTilesStack.pop();
            button.disabled = false; // Re-enable all used buttons
        }


        }

        function restartGame() {
            clearWords();
            createTiles(); // Recreate tiles based on frequencies
        }

        function backspace() {
            if (topWordField.value.length > 0) {
                topWordField.value = topWordField.value.slice(0, -1); // Remove the last character from the top word
            }
            if (bottomWordField.value.length > 0) {
                bottomWordField.value = bottomWordField.value.slice(0, -1); // Remove the last character from the bottom word
            }
	            if (usedTilesStack.length > 0) {
            const button = usedTilesStack.pop();
            button.disabled = false; // Re-enable the last used button
        }
            checkWords(); // Check words after backspacing
        }

        function checkWords() {
            const topWord = topWordField.value.toLowerCase();
            const bottomWord = bottomWordField.value.toLowerCase(); //bottomWordField.value.split('').reverse().join('').toLowerCase(); // Reverse the bottom word

            const isTopWordValid = wordSet.has(topWord);
            const isBottomWordValid = wordSet.has(bottomWord);

            topValidation.textContent = isTopWordValid ? '✅' : '❌';
            bottomValidation.textContent = isBottomWordValid ? '✅' : '❌';

            winMessage.style.display = (isTopWordValid && isBottomWordValid) ? 'block' : 'none';
        }

        // Initialize game
        createTiles();
    </script>
</body>
</html>

